<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tutorial 2: Regressors from ecg data &mdash; niphlem 0.0.1-beta documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery-rendered-html.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tutorial 3: Regressors from pulse oximeter data" href="tutorial3.html" />
    <link rel="prev" title="Tutorial 1: QC report for ecg data" href="tutorial1.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> niphlem
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorial1.html">Tutorial 1: QC report for ecg data</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Tutorial 2: Regressors from ecg data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Load-data">Load data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Retroicor-regressors">Retroicor regressors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Variation-model’s-regressors">Variation model’s regressors</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutorial3.html">Tutorial 3: Regressors from pulse oximeter data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citing.html">Citing niphlem</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">niphlem</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../tutorials.html">Tutorials</a> &raquo;</li>
      <li>Tutorial 2: Regressors from ecg data</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorials/tutorial2.nblink.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Tutorial-2:-Regressors-from-ecg-data">
<h1>Tutorial 2: Regressors from ecg data<a class="headerlink" href="#Tutorial-2:-Regressors-from-ecg-data" title="Permalink to this headline"></a></h1>
<p>This example shows how to use <em>niphlem</em> for one subject from one of our particular projects. These data consist of one acquisition of resting-state that has been previously preprocesses using <em>fMRIPrep</em> and physiological acquired through a Siemens multiband protocol. For the sake of simplicity in this example, we are going to concentrate only on cardiac signal reprsented by the ECG.</p>
<p>In addition, we are going to show the maps generated by the <em>niphlem</em> generated regressors using the library <em>nilearn</em> (<a class="reference external" href="https://nilearn.github.io/">https://nilearn.github.io/</a>)</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># IMPORTS</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">image</span><span class="p">,</span> <span class="n">plotting</span>
<span class="kn">from</span> <span class="nn">nilearn.glm.first_level</span> <span class="kn">import</span> <span class="n">FirstLevelModel</span>

<span class="kn">from</span> <span class="nn">niphlem.input_data</span> <span class="kn">import</span> <span class="p">(</span><span class="n">load_cmrr_info</span><span class="p">,</span> <span class="n">load_cmrr_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Let’s start definining our data</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Our preprocessed BOLD image</span>
<span class="n">run_img</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">load_img</span><span class="p">(</span><span class="s2">&quot;./data/demo/sub-06_ses-04_task-resting_run-01_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz&quot;</span><span class="p">)</span>
<span class="c1"># The repetition time of the scanner</span>
<span class="n">t_r</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="c1"># The frame times, used to define the regressors at the precise times</span>
<span class="n">n_vols</span> <span class="o">=</span> <span class="n">run_img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">frame_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_vols</span><span class="p">)</span><span class="o">*</span><span class="n">t_r</span>
<span class="c1"># Our file with the confounder regressors as a Dataframe. It will be used later to extract the motion parameters</span>
<span class="n">conf_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;./data/demo/sub-06_ses-04_task-resting_run-01_desc-confounds_regressors.tsv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Our physiological data, the info log file and the ECG log file</span>
<span class="n">info_log</span> <span class="o">=</span> <span class="s2">&quot;./data/demo/physio/Physio_20210322_140315_89a222d1-4c24-4caf-a898-f06c6bfd2342_Info.log&quot;</span>
<span class="n">ecg_log</span> <span class="o">=</span> <span class="s2">&quot;./data/demo/physio/Physio_20210322_140315_89a222d1-4c24-4caf-a898-f06c6bfd2342_ECG.log&quot;</span>
</pre></div>
</div>
</div>
<section id="Load-data">
<h2>Load data<a class="headerlink" href="#Load-data" title="Permalink to this headline"></a></h2>
<p>The first thing that we need is to load the info file, which will give us the times of the scanner. We can load this kind of the data using the function <code class="docutils literal notranslate"><span class="pre">niphlem.input_data.load_cmrr_info</span></code>. The only thing that we have to do is to pass the info log file to this function, and it will return the time traces and a dictionary with some meta information which is at the beginning of the file.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">time_traces</span><span class="p">,</span> <span class="n">meta_info</span> <span class="o">=</span> <span class="n">load_cmrr_info</span><span class="p">(</span><span class="n">info_log</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">meta_info</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;uuid&#39;: &#39;89a222d1-4c24-4caf-a898-f06c6bfd2342&#39;,
 &#39;scan_date&#39;: &#39;20210322_140315&#39;,
 &#39;log_version&#39;: &#39;EJA_1&#39;,
 &#39;n_slices&#39;: 68,
 &#39;n_vols&#39;: 353,
 &#39;n_echoes&#39;: 1,
 &#39;init_physio&#39;: 20241969,
 &#39;end_physio&#39;: 20457989,
 &#39;init_scan&#39;: 20246200,
 &#39;end_scan&#39;: 20457978,
 &#39;repetition_time&#39;: 600.0}
</pre></div></div>
</div>
<p>Now that we have the time traces, we are going to load our ECG data by passing to the function <code class="docutils literal notranslate"><span class="pre">niphlem.input_data.load_cmrr_data</span></code> its log file and the meta information dictionary that we’ve just generated. This dictionary is required to be able to synchronize the physiological signal with the scanner times. We also specify the type of signal, as a new entry to an updated dictionary will be added, containing meta information of this ECG signal.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ecg_signal</span><span class="p">,</span> <span class="n">meta_info</span> <span class="o">=</span> <span class="n">load_cmrr_data</span><span class="p">(</span><span class="n">ecg_log</span><span class="p">,</span> <span class="n">info_dict</span><span class="o">=</span><span class="n">meta_info</span><span class="p">,</span> <span class="n">sig_type</span><span class="o">=</span><span class="s2">&quot;cardiac&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Let’s have a look into a portion of this signal, corresponding to 2 s</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecg_signal</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;electrode 1&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1000</span> <span class="o">+</span> <span class="n">ecg_signal</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;electrode 2&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">2000</span> <span class="o">+</span> <span class="n">ecg_signal</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;electrode 3&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">3000</span> <span class="o">+</span> <span class="n">ecg_signal</span><span class="p">[:,</span><span class="mi">3</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;electrode 4&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">800</span><span class="p">])</span>
<span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_tutorial2_12_0.png" src="../_images/tutorials_tutorial2_12_0.png" />
</div>
</div>
<p>Let’s also have a look at the updated information dictionary.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">meta_info</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;uuid&#39;: &#39;89a222d1-4c24-4caf-a898-f06c6bfd2342&#39;,
 &#39;scan_date&#39;: &#39;20210322_140315&#39;,
 &#39;log_version&#39;: &#39;EJA_1&#39;,
 &#39;n_slices&#39;: 68,
 &#39;n_vols&#39;: 353,
 &#39;n_echoes&#39;: 1,
 &#39;init_physio&#39;: 20241969,
 &#39;end_physio&#39;: 20457989,
 &#39;init_scan&#39;: 20246200,
 &#39;end_scan&#39;: 20457978,
 &#39;repetition_time&#39;: 600.0,
 &#39;cardiac&#39;: {&#39;n_channels&#39;: 4, &#39;sample_rate&#39;: 1}}
</pre></div></div>
</div>
</section>
<section id="Retroicor-regressors">
<h2>Retroicor regressors<a class="headerlink" href="#Retroicor-regressors" title="Permalink to this headline"></a></h2>
<p>Let’s start the generation of regressors for the Retroicor Model. The class for generating these regressors is found as <code class="docutils literal notranslate"><span class="pre">niphlem.models.RetroicorPhysio</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">niphlem.models</span> <span class="kn">import</span> <span class="n">RetroicorPhysio</span>
</pre></div>
</div>
</div>
<p>Let’s have a look at the documentation of the class</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">RetroicorPhysio</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

     Physiological regressors using Retroicor.

    Parameters
    ----------
    physio_rate : float
        Sampling rate for the recording in Hz.
        This is needed for filtering to define the nyquist frequency.
    t_r : float
        Repetition time for the scanner (the usual T_R) in secs.
    delta: float
        minimum separation (in physio recording units) between
        events in signal to be considered peaks
    peak_rise: float
        relative height with respect to the 20th tallest events in signal
        to consider events as peak.
    order: int or array-like of shape (n_orders,)
        Fourier expansion for phases. If int, the fourier expansion is
        performed to that order, starting from 1. If an array is provided,
        each element will multiply the phases.
    transform : {&#34;demean&#34;, &#34;zscore&#34;, &#34;abs&#34;}, optional
        Transform data before filtering. The default is &#34;demean&#34;.
    high_pass : float, optional
        High-pass filtering frequency (in Hz). The default is None.
    low_pass : float, optional
        Low-pass filtering frequency (in Hz). The default is None.
    columns : List or array of n_channels elements, &#34;mean&#34; or None, optional
        It describes how to handle input signal channels. If a list, it will
        weight each channel and take the dot product. If &#34;mean&#34;,
        the average across the channels. If None, it will consider each
        channel separately. The default is None.
    peak_correct : bool, optional
        Whether to apply an automatic Grubbs&#39; test for peak outlier
        correction. The default is True.
    n_jobs : int, optional
        Number of jobs to consider in parallel. The default is 1.

</pre></div></div>
</div>
<p>We have three required arguments (physio_rate, t_r, delta) and a bunch of optional ones. In our case <em>physio_rate</em> is 400 Hz, t_r is 1.5 s and delta=200, the minimu separation between peaks and that corresponds to 200, i.e. 2 peaks per second or at most 120 peaks per minute.</p>
<p>Before the computing any regressors, we are going to take the mean signal across all the for electrodes and then filter the signal between 0.5 and 3.0 Hz.</p>
<p>Finally, retroicor regressors of order 2 will be generated.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">retro_ecg</span> <span class="o">=</span> <span class="n">RetroicorPhysio</span><span class="p">(</span><span class="n">physio_rate</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="c1"># Physiological rate (400 Hz)</span>
                            <span class="n">t_r</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="c1"># Scan rate (1.5 s)</span>
                            <span class="n">delta</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                            <span class="n">peak_rise</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                            <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="c1"># mean across the four electrodes</span>
                            <span class="n">low_pass</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="c1"># keep frequencies below this</span>
                            <span class="n">high_pass</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="c1"># keep frequencies above this</span>
                            <span class="n">order</span><span class="o">=</span><span class="mi">2</span> <span class="c1"># order 2 of the retroicor expansion</span>
                           <span class="p">)</span>
</pre></div>
</div>
</div>
<p>Once we have defined this object, we generate the regressors using the method <code class="docutils literal notranslate"><span class="pre">compute_regressors</span></code>, which is comon to all the models</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">retroicor_regressors</span> <span class="o">=</span> <span class="n">retro_ecg</span><span class="o">.</span><span class="n">compute_regressors</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">ecg_signal</span><span class="p">,</span> <span class="n">time_scan</span><span class="o">=</span><span class="n">frame_times</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Let’s see the a part of these regressors</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">frame_times</span><span class="p">,</span> <span class="n">retroicor_regressors</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;sin1&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">frame_times</span><span class="p">,</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">retroicor_regressors</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;cos1&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">frame_times</span><span class="p">,</span> <span class="mi">6</span> <span class="o">+</span> <span class="n">retroicor_regressors</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;sin2&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">frame_times</span><span class="p">,</span> <span class="mi">9</span> <span class="o">+</span> <span class="n">retroicor_regressors</span><span class="p">[:,</span><span class="mi">3</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;cos2&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;time (s)&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_tutorial2_25_0.png" src="../_images/tutorials_tutorial2_25_0.png" />
</div>
</div>
<p>Let’s build now a design matrix that contains these regressors in addition to the motion parameters and an intercept.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dm_retroicor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frame_times</span><span class="p">)),</span> <span class="c1"># Intercept</span>
                                <span class="n">conf_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s2">&quot;rot|trans&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="c1"># Motion parameters</span>
                                <span class="n">retroicor_regressors</span> <span class="c1"># ECG regressors</span>
                               <span class="p">))</span>
<span class="n">dm_retroicor</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dm_retroicor</span><span class="p">,</span>
                            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;intercept&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;trans_x&quot;</span><span class="p">,</span><span class="s2">&quot;trans_y&quot;</span><span class="p">,</span><span class="s2">&quot;trans_z&quot;</span><span class="p">,</span><span class="s2">&quot;rot_x&quot;</span><span class="p">,</span><span class="s2">&quot;rot_y&quot;</span><span class="p">,</span><span class="s2">&quot;rot_z&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;sin1&quot;</span><span class="p">,</span> <span class="s2">&quot;cos1&quot;</span><span class="p">,</span> <span class="s2">&quot;sin2&quot;</span><span class="p">,</span> <span class="s2">&quot;cos2&quot;</span>
                                      <span class="p">]</span>
                     <span class="p">)</span>
<span class="n">dm_retroicor</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">frame_times</span>
<span class="n">dm_retroicor</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>intercept</th>
      <th>trans_x</th>
      <th>trans_y</th>
      <th>trans_z</th>
      <th>rot_x</th>
      <th>rot_y</th>
      <th>rot_z</th>
      <th>sin1</th>
      <th>cos1</th>
      <th>sin2</th>
      <th>cos2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.0</th>
      <td>1.0</td>
      <td>0.031165</td>
      <td>-0.003878</td>
      <td>-0.027213</td>
      <td>-0.001164</td>
      <td>0.000187</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>1.5</th>
      <td>1.0</td>
      <td>0.021195</td>
      <td>-0.071983</td>
      <td>-0.047930</td>
      <td>0.000039</td>
      <td>0.000260</td>
      <td>0.000000</td>
      <td>-0.989701</td>
      <td>0.143149</td>
      <td>-0.283349</td>
      <td>-0.959017</td>
    </tr>
    <tr>
      <th>3.0</th>
      <td>1.0</td>
      <td>0.017855</td>
      <td>-0.041552</td>
      <td>-0.036992</td>
      <td>0.000027</td>
      <td>0.000076</td>
      <td>-0.000260</td>
      <td>0.145010</td>
      <td>-0.989430</td>
      <td>-0.286955</td>
      <td>0.957944</td>
    </tr>
    <tr>
      <th>4.5</th>
      <td>1.0</td>
      <td>0.013670</td>
      <td>0.072409</td>
      <td>-0.036982</td>
      <td>-0.000340</td>
      <td>0.000188</td>
      <td>-0.000202</td>
      <td>0.550055</td>
      <td>0.835128</td>
      <td>0.918733</td>
      <td>0.394879</td>
    </tr>
    <tr>
      <th>6.0</th>
      <td>1.0</td>
      <td>0.009882</td>
      <td>-0.046013</td>
      <td>-0.040077</td>
      <td>0.000352</td>
      <td>0.000367</td>
      <td>-0.000228</td>
      <td>-0.999079</td>
      <td>0.042905</td>
      <td>-0.085731</td>
      <td>-0.996318</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dm_retroicor</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dm_retroicor</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">dm_retroicor</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_tutorial2_28_0.png" src="../_images/tutorials_tutorial2_28_0.png" />
</div>
</div>
<p>Now fit this design matrix to our BOLD image</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">first_level</span> <span class="o">=</span> <span class="n">FirstLevelModel</span><span class="p">(</span><span class="n">t_r</span><span class="o">=</span><span class="n">t_r</span><span class="p">,</span> <span class="n">drift_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">signal_scaling</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">smoothing_fwhm</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">first_level</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">run_imgs</span><span class="o">=</span><span class="n">run_img</span><span class="p">,</span> <span class="n">design_matrices</span><span class="o">=</span><span class="n">dm_retroicor</span><span class="p">)</span>
<span class="n">retroicor_map</span> <span class="o">=</span> <span class="n">first_level</span><span class="o">.</span><span class="n">compute_contrast</span><span class="p">(</span><span class="s2">&quot;sin1+cos1+sin2+cos2&quot;</span><span class="p">,</span> <span class="n">stat_type</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="n">output_type</span><span class="o">=</span><span class="s2">&quot;z_score&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>And plot this map in a glass brain fashion</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plotting</span><span class="o">.</span><span class="n">plot_glass_brain</span><span class="p">(</span><span class="n">retroicor_map</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">1.96</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;nilearn.plotting.displays.OrthoProjector at 0x7fd644d7ea00&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_tutorial2_32_1.png" src="../_images/tutorials_tutorial2_32_1.png" />
</div>
</div>
</section>
<section id="Variation-model’s-regressors">
<h2>Variation model’s regressors<a class="headerlink" href="#Variation-model’s-regressors" title="Permalink to this headline"></a></h2>
<p>Let’s continue now with the generation of regressors using the Variation Model. The class for generating these regressors is found as <code class="docutils literal notranslate"><span class="pre">niphlem.models.HVPhysio</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">niphlem.models</span> <span class="kn">import</span> <span class="n">HVPhysio</span>
</pre></div>
</div>
</div>
<p>Let’s have a look at the documentation of the class</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">HVPhysio</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

     Physiological regressors for variations in heart rate.

    Parameters
    ----------
    physio_rate : float
        Sampling rate for the recording in Hz.
        This is needed for filtering to define the nyquist frequency.
    t_r : float
        Repetition time for the scanner (the usual T_R) in secs.
    delta: float
        minimum separation (in physio recording units) between
        events in signal to be considered peaks
    peak_rise: float
        relative height with respect to the 20th tallest events in signal
        to consider events as peak.
    time_window : float
        Time window (in secs) around the T_R from which computing variations
        (time differences between signal events ). The default is 6 secs.
    transform : {&#34;demean&#34;, &#34;zscore&#34;, &#34;abs&#34;}, optional
        Transform data before filtering. The default is &#34;demean&#34;.
    high_pass : float, optional
        High-pass filtering frequency (in Hz). The default is None.
    low_pass : float, optional
        Low-pass filtering frequency (in Hz).  The default is None.
    columns : List or array of n_channels elements, &#34;mean&#34; or None, optional
        It describes how to handle input signal channels. If a list, it will
        weight each channel and take the dot product. If &#34;mean&#34;,
        the average across the channels. If None, it will consider each
        channel separately. The default is None.
    peak_correct : bool, optional
        Whether to apply an automatic Grubbs&#39; test for peak outlier
        correction. The default is True.
    n_jobs : int, optional
        Number of jobs to consider in parallel. The default is 1.

</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">variaton_ecg</span> <span class="o">=</span> <span class="n">HVPhysio</span><span class="p">(</span><span class="n">physio_rate</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">t_r</span><span class="o">=</span><span class="n">t_r</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span>
                        <span class="n">low_pass</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">high_pass</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">peak_rise</span><span class="o">=</span><span class="mf">0.5</span>
                       <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">variation_regressors</span> <span class="o">=</span> <span class="n">variaton_ecg</span><span class="o">.</span><span class="n">compute_regressors</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">ecg_signal</span><span class="p">,</span> <span class="n">time_scan</span><span class="o">=</span><span class="n">frame_times</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">frame_times</span><span class="p">,</span> <span class="n">variation_regressors</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ecg_var&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;time (s)&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_tutorial2_40_0.png" src="../_images/tutorials_tutorial2_40_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dm_variation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frame_times</span><span class="p">)),</span> <span class="c1"># Intercept</span>
                                <span class="n">conf_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s2">&quot;rot|trans&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="c1"># Motion parameters</span>
                                <span class="n">variation_regressors</span> <span class="c1"># ECG regressors</span>
                         <span class="p">))</span>

<span class="n">dm_variation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dm_variation</span><span class="p">,</span>
                            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;intercept&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;trans_x&quot;</span><span class="p">,</span><span class="s2">&quot;trans_y&quot;</span><span class="p">,</span><span class="s2">&quot;trans_z&quot;</span><span class="p">,</span><span class="s2">&quot;rot_x&quot;</span><span class="p">,</span><span class="s2">&quot;rot_y&quot;</span><span class="p">,</span><span class="s2">&quot;rot_z&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;ecg_var&quot;</span>
                                    <span class="p">]</span>
                     <span class="p">)</span>
<span class="n">dm_variation</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">frame_times</span>
<span class="n">dm_variation</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>intercept</th>
      <th>trans_x</th>
      <th>trans_y</th>
      <th>trans_z</th>
      <th>rot_x</th>
      <th>rot_y</th>
      <th>rot_z</th>
      <th>ecg_var</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.0</th>
      <td>1.0</td>
      <td>0.031165</td>
      <td>-0.003878</td>
      <td>-0.027213</td>
      <td>-0.001164</td>
      <td>0.000187</td>
      <td>0.000000</td>
      <td>-0.000677</td>
    </tr>
    <tr>
      <th>1.5</th>
      <td>1.0</td>
      <td>0.021195</td>
      <td>-0.071983</td>
      <td>-0.047930</td>
      <td>0.000039</td>
      <td>0.000260</td>
      <td>0.000000</td>
      <td>0.661642</td>
    </tr>
    <tr>
      <th>3.0</th>
      <td>1.0</td>
      <td>0.017855</td>
      <td>-0.041552</td>
      <td>-0.036992</td>
      <td>0.000027</td>
      <td>0.000076</td>
      <td>-0.000260</td>
      <td>1.652585</td>
    </tr>
    <tr>
      <th>4.5</th>
      <td>1.0</td>
      <td>0.013670</td>
      <td>0.072409</td>
      <td>-0.036982</td>
      <td>-0.000340</td>
      <td>0.000188</td>
      <td>-0.000202</td>
      <td>1.194417</td>
    </tr>
    <tr>
      <th>6.0</th>
      <td>1.0</td>
      <td>0.009882</td>
      <td>-0.046013</td>
      <td>-0.040077</td>
      <td>0.000352</td>
      <td>0.000367</td>
      <td>-0.000228</td>
      <td>-1.499796</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dm_variation</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dm_variation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">dm_variation</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_tutorial2_42_0.png" src="../_images/tutorials_tutorial2_42_0.png" />
</div>
</div>
<p>Again, let’s fit this design matrix to our BOLD data and show the pattern obtained</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">first_level</span> <span class="o">=</span> <span class="n">FirstLevelModel</span><span class="p">(</span><span class="n">t_r</span><span class="o">=</span><span class="n">t_r</span><span class="p">,</span> <span class="n">drift_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">signal_scaling</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">smoothing_fwhm</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">first_level</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">run_imgs</span><span class="o">=</span><span class="n">run_img</span><span class="p">,</span> <span class="n">design_matrices</span><span class="o">=</span><span class="n">dm_variation</span><span class="p">)</span>
<span class="n">variation_map</span> <span class="o">=</span> <span class="n">first_level</span><span class="o">.</span><span class="n">compute_contrast</span><span class="p">(</span><span class="s2">&quot;ecg_var&quot;</span><span class="p">,</span> <span class="n">stat_type</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="n">output_type</span><span class="o">=</span><span class="s2">&quot;z_score&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plotting</span><span class="o">.</span><span class="n">plot_glass_brain</span><span class="p">(</span><span class="n">variation_map</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">1.96</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;nilearn.plotting.displays.OrthoProjector at 0x7fd640c25730&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_tutorial2_45_1.png" src="../_images/tutorials_tutorial2_45_1.png" />
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tutorial1.html" class="btn btn-neutral float-left" title="Tutorial 1: QC report for ecg data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tutorial3.html" class="btn btn-neutral float-right" title="Tutorial 3: Regressors from pulse oximeter data" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, coaxlab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>