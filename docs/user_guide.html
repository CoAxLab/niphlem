<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>User guide &mdash; niphlem 0.0.1-beta documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="_static/sg_gallery-rendered-html.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tutorials" href="tutorials.html" />
    <link rel="prev" title="niphlem: Physiological Log Extraction for Modeling in Neuroimaging" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> niphlem
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">User guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#intro-to-niphlem">1-Intro to Niphlem</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#what-is-niphlem">1.1- What is Niphlem?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-niphlem">1.2- Installing niphlem</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#physiological-signal">2-Physiological Signal</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#loading-physiological-data-from-cmrr-mb-sequences">2.1- Loading physiological data from CMRR MB sequences</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loading-physiological-data-in-bids-format">2.2- Loading physiological data in BIDS format</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#retroicor-models">3-RETROICOR Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="#variation-models">4-Variation Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#variation-in-breathing-rate-volume-regressors">4.1- Variation in breathing rate/volume regressors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#variation-in-heart-rate-regressors">4.2- Variation in heart rate regressors</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#reports">5-Reports</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="citing.html">Citing niphlem</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">niphlem</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>User guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/user_guide.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="user-guide">
<h1>User guide<a class="headerlink" href="#user-guide" title="Permalink to this headline"></a></h1>
<section id="intro-to-niphlem">
<h2>1-Intro to Niphlem<a class="headerlink" href="#intro-to-niphlem" title="Permalink to this headline"></a></h2>
<section id="what-is-niphlem">
<h3>1.1- What is Niphlem?<a class="headerlink" href="#what-is-niphlem" title="Permalink to this headline"></a></h3>
<p>Nilearn-dependent Physiological Log Extraction for Modeling (<em>Niphlem</em>) is a toolbox designed to preprocess phsyiological signals collected during MRI scannings. It is able to estimate covariates from these recordings that can be used later in general linear model (GLM) analyses of fMRI data.</p>
<p>This is the python version of the original PhLEM toolbox written in Matlab (and no longer supported). The aim is to be as simple, flexible, and open as possible. Such flexibility thus assumes a very basic knowledge of Python. If you do not feel confortable or are not familiar with this programming language, we recommed that you learn at least the most basic notions. For example, a good source for this may be the <a class="reference external" href="http://scipy-lectures.org/">scipy lecture notes</a>.</p>
</section>
<section id="installing-niphlem">
<h3>1.2- Installing niphlem<a class="headerlink" href="#installing-niphlem" title="Permalink to this headline"></a></h3>
<p><em>niphlem</em> can be easily installed through pypi as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">U</span> <span class="n">niphlem</span>
</pre></div>
</div>
<p>The dependencies, beyond those libraries that come with python distributions, are numpy, matplotlib, pandas, scipy, scikit-learn and outlier_utils. All of these are checked and installed if missing when installing <em>niphlem</em>.</p>
<p>Alternatively, if you are interested in installing the latest version under development, you may clone the github repository and install it from there directly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">CoAxLab</span><span class="o">/</span><span class="n">niphlem</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">niphlem</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">U</span> <span class="o">.</span>
</pre></div>
</div>
</section>
</section>
<section id="physiological-signal">
<h2>2-Physiological Signal<a class="headerlink" href="#physiological-signal" title="Permalink to this headline"></a></h2>
<p><em>Niphlem</em> is designed to exctract physiological signals (cardiac, respiration) from electrocardiogram (ECG), pneumatic belt or pulse oximeter (pulse-ox) data recordings that are collected as participants are scanned in an MRI. The toolbox was specifically written with output from the Siemens Physiological Monitoring System in mind, but is able to work with and data in BIDS compliance. In the future, more formats of input physiological data will be incorporated.</p>
<section id="loading-physiological-data-from-cmrr-mb-sequences">
<h3>2.1- Loading physiological data from CMRR MB sequences<a class="headerlink" href="#loading-physiological-data-from-cmrr-mb-sequences" title="Permalink to this headline"></a></h3>
<p>Under construction…</p>
</section>
<section id="loading-physiological-data-in-bids-format">
<h3>2.2- Loading physiological data in BIDS format<a class="headerlink" href="#loading-physiological-data-in-bids-format" title="Permalink to this headline"></a></h3>
<p>Under construction…</p>
</section>
</section>
<section id="retroicor-models">
<h2>3-RETROICOR Models<a class="headerlink" href="#retroicor-models" title="Permalink to this headline"></a></h2>
<p>RETROICOR stands for Retrospective Image Correction and it calculates the fourier series expansion using the phases from the cardiac and respiratory cycles.</p>
<p>The algorithm in these models works as follows:</p>
<ol class="arabic simple">
<li><p>Extract the peaks in the physiological data. In the case of cardiac, signals these would correspond to the R components of the QRS complex. In the pneumatic belt signal, they would correspond to the peak expansion of the diaphragm. And for pulse-ox signals, the maxima in local blood oxygenation.</p></li>
<li><p>Estimation of a phase time to be between 0 and 2π between consecutive time peaks <span class="math notranslate nohighlight">\(t_1\)</span> and <span class="math notranslate nohighlight">\(t_2\)</span>, i.e., as having full phase cycles:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\phi(t) = \frac{2\pi (t - t_1)}{(t_2-t_1)}\]</div>
<ol class="arabic simple" start="3">
<li><p>Computation of sines and cosines of these phases up to a specified order, i.e. <span class="math notranslate nohighlight">\([sin(k\cdot\phi(t)), cos(k\cdot\phi(t))]\)</span>, with <span class="math notranslate nohighlight">\(k=1,2,\dots\)</span></p></li>
<li><p>Downsampling each of these terms to the scanner time resolution.</p></li>
</ol>
<p>After these four steps, we obtain a series of phase regressors that we can use in our fMRI models to account for the physiological signal.</p>
<figure class="align-center" id="id5">
<img alt="_images/retroicor_1.jpg" src="_images/retroicor_1.jpg" />
<figcaption>
<p><span class="caption-text">RETROICOR algorithm procedure (borrowed from Verstynen, 2011).</span><a class="headerlink" href="#id5" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Niphlem has a class <a class="reference external" href="https://coaxlab.github.io/niphlem/api.html#niphlem.models.RetroicorPhysio">RetroicorPhysio</a>, which preprocesses the initial data (transform and filter) and implements this algorithm to generate such regressors. For a detailed example of how to use this class, we recommend visiting the <a class="reference external" href="https://coaxlab.github.io/niphlem/tutorials/tutorial3.html">tutorial 3</a> and <a class="reference external" href="https://coaxlab.github.io/niphlem/tutorials/tutorial4.html">tutorial 4</a>.</p>
<p><em>Refernces</em>:</p>
<ul class="simple">
<li><p>Glover, G.H., Li, T.-Q. and Ress, D. (2000), Image-based method for retrospective correction of physiological motion effects in fMRI: RETROICOR. Magn. Reson. Med., 44: 162-167.</p></li>
<li><p>Verstynen TD, Deshpande V. Using pulse oximetry to account for high and low frequency physiological artifacts in the BOLD signal. Neuroimage. 2011 Apr 15;55(4):1633-44.</p></li>
</ul>
</section>
<section id="variation-models">
<h2>4-Variation Models<a class="headerlink" href="#variation-models" title="Permalink to this headline"></a></h2>
<p>Niphlem can also generate nuisance regressors for variation in breathing rate/volume and heart rate.</p>
<section id="variation-in-breathing-rate-volume-regressors">
<h3>4.1- Variation in breathing rate/volume regressors<a class="headerlink" href="#variation-in-breathing-rate-volume-regressors" title="Permalink to this headline"></a></h3>
<p>The algorithm for variability artifacts fromo breathing rate/volume is as follows:</p>
<ol class="arabic simple">
<li><p>Computation of the standard deviation of the signal within a time window centered at each TR. Such a time window has been usually taken as 3*TR long (Chang, 2009). This operation thus yields a time series at the scanner acquisition time resolution.</p></li>
<li><p>Z-score normalization.</p></li>
<li><p>Convolution with the respiratory response function (RRF(t)), which reads:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[RRF(t) = 0.6 t^{2.1} e^{-t/1.6} - 0.0023 t^{3.54} e^{-t/4.25}\]</div>
<p>Niphlem has a class <a class="reference external" href="https://coaxlab.github.io/niphlem/api.html#niphlem.models.RVPhysio">RVPhysio</a>, which preprocesses the initial data (transform and filter) and implements this algorithm to generate such regressors. For a detailed example of how to use this class, we recommend visiting the <a class="reference external" href="https://coaxlab.github.io/niphlem/tutorials/tutorial3.html">tutorial 3</a> and <a class="reference external" href="https://coaxlab.github.io/niphlem/tutorials/tutorial4.html">tutorial 4</a>.</p>
<figure class="align-center" id="id6">
<img alt="_images/variations_rv.jpg" src="_images/variations_rv.jpg" />
<figcaption>
<p><span class="caption-text">Variations in breathing rate/volume procedure (borrowed from Verstynen, 2011).</span><a class="headerlink" href="#id6" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="variation-in-heart-rate-regressors">
<h3>4.2- Variation in heart rate regressors<a class="headerlink" href="#variation-in-heart-rate-regressors" title="Permalink to this headline"></a></h3>
<p>The algorithm for variability artifacts from heart rate is as follows:</p>
<ol class="arabic simple">
<li><p>Computation of the average deviation in inter-event interval (i.e., ms between R-components of the QRS complex), per second,  within a time window centered at each TR. Such a time window has been usually taken as 3*TR long (Chang, 2009). This operation thus yields a time series at the scanner acquisition time resolution.</p></li>
<li><p>Z-score normalization.</p></li>
<li><p>Convolution with the respiratory response function (CRF(t)), which reads:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[CRF(t) = 0.6 t^{2.7}e^{-t/1.6} - \frac{16}{\sqrt{18 \pi }}e^{-\frac{1}{2}\frac{(t-12)^2}{9}}\]</div>
<p>Niphlem has a class <a class="reference external" href="https://coaxlab.github.io/niphlem/api.html#niphlem.models.HVPhysio">HVPhysio</a>, which preprocesses the initial data (transform and filter) and implements this algorithm to generate such regressors. For a detailed example of how to use this class, we recommend visiting the <a class="reference external" href="https://coaxlab.github.io/niphlem/tutorials/tutorial3.html">tutorial 3</a> and <a class="reference external" href="https://coaxlab.github.io/niphlem/tutorials/tutorial4.html">tutorial 4</a>.</p>
<figure class="align-center" id="id7">
<img alt="_images/variations_hv.jpg" src="_images/variations_hv.jpg" />
<figcaption>
<p><span class="caption-text">Variations in heart rate procedure (borrowed from Verstynen, 2011).</span><a class="headerlink" href="#id7" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p><em>References</em>:</p>
<ul class="simple">
<li><p>Birn RM, Smith MA, Jones TB, Bandettini PA. The respiration response function: the temporal dynamics of fMRI signal fluctuations related to changes in respiration. Neuroimage. 2008;40(2):644-654.</p></li>
<li><p>Chang C, Cunningham JP, Glover GH. Influence of heart rate on the BOLD signal: the cardiac response function. Neuroimage. 2009 Feb 1;44(3):857-69.</p></li>
<li><p>Verstynen TD, Deshpande V. Using pulse oximetry to account for high and low frequency physiological artifacts in the BOLD signal. Neuroimage. 2011 Apr 15;55(4):1633-44.</p></li>
</ul>
</section>
</section>
<section id="reports">
<h2>5-Reports<a class="headerlink" href="#reports" title="Permalink to this headline"></a></h2>
<p>Under construction…</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="niphlem: Physiological Log Extraction for Modeling in Neuroimaging" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tutorials.html" class="btn btn-neutral float-right" title="Tutorials" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, coaxlab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>